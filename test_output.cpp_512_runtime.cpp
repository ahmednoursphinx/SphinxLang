// Runtime test file - executes and prints results (512-bit VPCLMULQDQ)
// Compile with Clang: clang++ -x c++ -target x86_64-unknown-linux-gnu -mvpclmulqdq -mavx512f -mevex512 -std=c++11 test_output.cpp_512_runtime.cpp -o test_output.cpp_512_runtime
// Compile with GCC:   g++ -x c++ -mvpclmulqdq -mavx512f -mevex512 -std=c++11 test_output.cpp_512_runtime.cpp -o test_output.cpp_512_runtime

#include <immintrin.h>
#include <stdio.h>

int main() {

  // Edge case 1: all zeros
  {
    __v8du a_u = {0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL};
    __v8du b_u = {0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x00);
    
    __v8du v = (__v8du)result;
    printf("TEST_0: {0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL}, {0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL, 0ULL}, 0x00 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  // Edge case 2: all ones * all ones
  {
    __v8du a_u = {18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL};
    __v8du b_u = {18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x00);
    
    __v8du v = (__v8du)result;
    printf("TEST_1: {18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL}, {18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL, 18446744073709551615ULL, 0ULL}, 0x00 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  // Edge case 3: high bit * high bit
  {
    __v8du a_u = {9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL};
    __v8du b_u = {9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x00);
    
    __v8du v = (__v8du)result;
    printf("TEST_2: {9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL}, {9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL, 9223372036854775808ULL, 0ULL}, 0x00 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  // Edge case 4: 2^0 * 2^0
  {
    __v8du a_u = {1ULL, 0ULL, 1ULL, 0ULL, 1ULL, 0ULL, 1ULL, 0ULL};
    __v8du b_u = {1ULL, 0ULL, 1ULL, 0ULL, 1ULL, 0ULL, 1ULL, 0ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x00);
    
    __v8du v = (__v8du)result;
    printf("TEST_3: {1ULL, 0ULL, 1ULL, 0ULL, 1ULL, 0ULL, 1ULL, 0ULL}, {1ULL, 0ULL, 1ULL, 0ULL, 1ULL, 0ULL, 1ULL, 0ULL}, 0x00 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  // Edge case 5: 2^16 * 2^16
  {
    __v8du a_u = {65536ULL, 0ULL, 65536ULL, 0ULL, 65536ULL, 0ULL, 65536ULL, 0ULL};
    __v8du b_u = {65536ULL, 0ULL, 65536ULL, 0ULL, 65536ULL, 0ULL, 65536ULL, 0ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x00);
    
    __v8du v = (__v8du)result;
    printf("TEST_4: {65536ULL, 0ULL, 65536ULL, 0ULL, 65536ULL, 0ULL, 65536ULL, 0ULL}, {65536ULL, 0ULL, 65536ULL, 0ULL, 65536ULL, 0ULL, 65536ULL, 0ULL}, 0x00 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  // Edge case 6: 2^32 * 2^32
  {
    __v8du a_u = {4294967296ULL, 0ULL, 4294967296ULL, 0ULL, 4294967296ULL, 0ULL, 4294967296ULL, 0ULL};
    __v8du b_u = {4294967296ULL, 0ULL, 4294967296ULL, 0ULL, 4294967296ULL, 0ULL, 4294967296ULL, 0ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x00);
    
    __v8du v = (__v8du)result;
    printf("TEST_5: {4294967296ULL, 0ULL, 4294967296ULL, 0ULL, 4294967296ULL, 0ULL, 4294967296ULL, 0ULL}, {4294967296ULL, 0ULL, 4294967296ULL, 0ULL, 4294967296ULL, 0ULL, 4294967296ULL, 0ULL}, 0x00 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  // Edge case 7: 2^48 * 2^48
  {
    __v8du a_u = {281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL};
    __v8du b_u = {281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x00);
    
    __v8du v = (__v8du)result;
    printf("TEST_6: {281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL}, {281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL, 281474976710656ULL, 0ULL}, 0x00 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  // Fuzz test 0: imm8=0x00
  {
    __v8du a_u = {3151221064528925568ULL, 767944316300140009ULL, 16831411637485938771ULL, 14448134893552120507ULL, 12064858145323334948ULL, 9681581397094549390ULL, 7298304653160731126ULL, 4915027909226912863ULL};
    __v8du b_u = {2531751160998127305ULL, 148474412769341746ULL, 16211941738250107802ULL, 13828664990021322243ULL, 11445388241792536685ULL, 9062111497858718421ULL, 6678834749629932862ULL, 4295558005696114600ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x00);
    
    __v8du v = (__v8du)result;
    printf("TEST_7: {3151221064528925568ULL, 767944316300140009ULL, 16831411637485938771ULL, 14448134893552120507ULL, 12064858145323334948ULL, 9681581397094549390ULL, 7298304653160731126ULL, 4915027909226912863ULL}, {2531751160998127305ULL, 148474412769341746ULL, 16211941738250107802ULL, 13828664990021322243ULL, 11445388241792536685ULL, 9062111497858718421ULL, 6678834749629932862ULL, 4295558005696114600ULL}, 0x00 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  // Fuzz test 1: imm8=0x10
  {
    __v8du a_u = {10825918342556705716ULL, 8442641594327920157ULL, 6059364846099134599ULL, 3676088106460283631ULL, 1292811358231498072ULL, 17356278679417296834ULL, 14973001931188511275ULL, 12589725187254693011ULL};
    __v8du b_u = {10206448439025907452ULL, 7823171690797121894ULL, 5439894951158270926ULL, 3056618202929485367ULL, 673341454700699809ULL, 16736808775886498570ULL, 14353532031952680306ULL, 11970255283723894747ULL};
    __m512i a = (__m512i)a_u;
    __m512i b = (__m512i)b_u;
    
    __m512i result = _mm512_clmulepi64_epi128(a, b, 0x10);
    
    __v8du v = (__v8du)result;
    printf("TEST_8: {10825918342556705716ULL, 8442641594327920157ULL, 6059364846099134599ULL, 3676088106460283631ULL, 1292811358231498072ULL, 17356278679417296834ULL, 14973001931188511275ULL, 12589725187254693011ULL}, {10206448439025907452ULL, 7823171690797121894ULL, 5439894951158270926ULL, 3056618202929485367ULL, 673341454700699809ULL, 16736808775886498570ULL, 14353532031952680306ULL, 11970255283723894747ULL}, 0x10 -> [0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx, 0x%016llx]\n", v[0], v[1], v[2], v[3], v[4], v[5], v[6], v[7]);
  }

  printf("All 9 tests executed successfully!\n");
  return 0;
}